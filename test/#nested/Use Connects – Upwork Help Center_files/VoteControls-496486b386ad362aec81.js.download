webpackJsonp([8],{1228:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o(1);t.default=a.View.extend({cleanupAttributes:function(){for(var e=this,t=this.el.attributes,o=[],a=0;a<t.length;a++){var l=t[a].nodeName;l.indexOf("data-")!==-1&&o.push(l)}o.forEach(function(t){return e.el.removeAttribute(t)})}})},1267:function(e,t,o){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var l=o(258),i=a(l),u=o(1),n=o(703),s=a(n);t.default=u.Model.extend({defaults:{upvote_count:0,vote_count:0,vote_sum:0,value:null,label:"",vote_url:""},constructor:function(){u.Model.apply(this,arguments),this.localStorageSupported=this.isLocalStorageSupported(),this.set({value:this.getVoteDirection()})},vote:function(e){var t=this,o=this.get("vote_url");if(this.alreadyVoted())return void this.fakeVote(e);u.$.ajax({url:o,type:"POST",data:{value:e},dataType:"json"}).done(function(e){t.saveVoteLocally(e.value),t.set(e)}).fail(function(){t.saveVoteLocally(e),t.set({value:e})})},alreadyVoted:function(){return null!==this.get("value")},getVoteDirection:function(){return this.readLocalVotes()[this.get("vote_url")]||null},fakeVote:function(e){var t=this.get("value")===e?"none":e;this.saveVoteLocally(t),this.set({value:t})},saveVoteLocally:function(e){var t=this.get("vote_url"),o=this.readLocalVotes();o[t]=e;var a=(0,i.default)(o);this.localStorageSupported?window.localStorage.setItem("articleVotes",a):s.default.set("articleVotes",a)},readLocalVotes:function(){var e=this.localStorageSupported?window.localStorage.getItem("articleVotes"):s.default.get("articleVotes");return JSON.parse(e||"{}")},isLocalStorageSupported:function(){try{return window.localStorage.setItem("testKey","1"),window.localStorage.removeItem("testKey"),!0}catch(e){return!1}}})},1268:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o(1);t.default=a.Model.extend({defaults:{upvote_count:0,vote_count:0,vote_sum:0,value:null,label:"",vote_url:""},vote:function(e){var t=this,o=this.get("value"),l=this.get("vote_url"),i=void 0;i=o?o===e?"DELETE":"PUT":"POST",a.$.ajax({type:i,url:l,data:{value:e},dataType:"json"}).done(function(e){return t.set(e)})}})},1269:function(e,t,o){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var l=o(1228),i=a(l);t.default=i.default.extend({events:{click:"onClick"},initialize:function(e){var t=e.direction,o=e.selectedClass;this.direction=t,this.selectedClass=o,this.listenTo(this.model,"change",this.render),this.cleanupAttributes()},render:function(){var e=this.direction===this.model.get("value");this.$el.toggleClass(this.selectedClass,e).attr("aria-selected",e)},onClick:function(e){e.preventDefault(),this.model.vote(this.direction)}})},1270:function(e,t,o){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var l=o(1228),i=a(l);t.default=i.default.extend({initialize:function(e){var t=e.type;this.type=t,this.listenTo(this.model,"change",this.render),this.cleanupAttributes()},render:function(){var e=void 0;switch(this.type){case"sum":e=this.model.get("vote_sum");break;case"count":e=this.model.get("vote_count")}this.$el.text(e)}})},1271:function(e,t,o){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var l=o(1228),i=a(l);t.default=i.default.extend({initialize:function(){this.listenTo(this.model,"change",this.render),this.cleanupAttributes()},render:function(){this.$el.text(this.model.get("label"))}})},702:function(e,t,o){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function l(e){var t=(0,u.default)("[data-helper=vote][data-item="+e+"]"),o=t.filter("[data-type=up], [data-type=down]"),a=t.filter("[data-type=label]"),l=t.filter("[data-type=count], [data-type=sum]");if(o.length){var i=s.default.get("user.role"),n=s.default.get("has_anonymous_kb_voting"),d="article"===e&&n&&"anonymous"===i,f=new r.Collection(null,{model:d?c.default:v.default}),h={buttons:[],labels:[],counters:[]};o.each(function(){var e=(0,u.default)(this).data(),t=e.id,o=e.value,a=e.label,l=e.type,i=e.selectedClass,n=e.upvoteCount,s=e.voteCount,r=e.voteSum,d=e.voteUrl,c=f.findWhere({id:t});c=c||f.add({id:t,value:o,label:a,upvote_count:n,vote_count:s,vote_sum:r,vote_url:d});var v=new p.default({model:c,el:this,direction:l,selectedClass:i});h.buttons.push(v),v.render()}),a.each(function(){var e=(0,u.default)(this).data(),t=e.id,o=f.findWhere({id:t}),a=new g.default({model:o,el:this});h.labels.push(a)}),l.each(function(){var e=(0,u.default)(this).data(),t=e.id,o=e.type,a=f.findWhere({id:t}),l=new m.default({model:a,el:this,type:o});h.counters.push(l)}),this.votes=f,this.views=h}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=l;var i=o(17),u=a(i),n=o(11),s=a(n),r=o(1),d=o(1267),c=a(d),f=o(1268),v=a(f),h=o(1269),p=a(h),_=o(1271),g=a(_),y=o(1270),m=a(y)}});